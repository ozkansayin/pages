<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <title>Berichtsbogen - Fachsprachprüfung</title>
    <style>
        body {
            font-family: "Arial", sans-serif;
            margin: 40px;
            background: #fff;
            color: #000;
        }

        h1,
        h2 {
            text-align: center;
            margin-bottom: 10px;
        }

        .section {
            border: 1px solid #000;
            padding: 15px;
            margin-bottom: 20px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .field {
            flex: 1;
            min-width: 150px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="text"],
        input[type="number"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 6px;
            box-sizing: border-box;
            border: 1px solid #ccc;
        }

        textarea {
            height: 80px;
        }

        .long-textarea {
            height: 1000px;
        }

        .print-button {
            display: block;
            margin: 40px auto;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #0078D4;
            color: white;
            border: none;
            cursor: pointer;
        }
 
        .print-button:hover {
            background-color: #005A9E;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

<body style="width: 1024px; margin: 0 auto;">

    <h1>Berichtsbogen - Fachsprachprüfung</h1>

    <div class="section">
        <div class="row">
            <div class="col-md-6">
                <div class="row">
                    <div class="field">
                        <label for="patient">Patient/in</label>
                        <textarea id="patient" name="patient"></textarea>
                    </div>
                </div>
                <div class="row">
                    <div class="field">
                        <label for="alter">Alter (Jahre)</label>
                        <input type="number" id="alter" name="alter">
                    </div>
                    <div class="field">
                        <label for="groesse">Größe (cm)</label>
                        <input type="number" id="groesse" name="groesse">
                    </div>
                    <div class="field">
                        <label for="gewicht">Gewicht (kg)</label>
                        <input type="number" id="gewicht" name="gewicht">
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                    <div class="field">
                        <label for="datum">Datum</label>
                        <input type="text" id="datum" name="datum" placeholder="">
                    </div>
            </div>

        </div>
    </div>

    <div class="section">
        <div class="section-title">Allergien / Unverträglichkeiten</div>
        <textarea name="allergien"></textarea>
    </div>

    <div class="section">
        <div class="section-title">Genussmittel / Drogen</div>
        <textarea name="genussmittel"></textarea>
    </div>

    <div class="section">
        <div class="section-title">Sozialanamnese</div>
        <textarea name="sozialanamnese"></textarea>
    </div>

    <div class="section">
        <div class="section-title">Familienanamnese</div>
        <textarea name="familienanamnese"></textarea>
    </div>

    <h2>Zusammenfassung des Anamnesegesprächs</h2>
    <div>Schreiben Sie eine Zusammenfassung des Anamnesegesprächs in Form eines
        Berichts mit <b>Anamnese/ Verdachtsdiagnose/ Vorschlägen zur weiteren Diagnostik
            und Therapievorschlägen</b>. Angaben der ersten Seite müssen hier nicht wiederholt
        werden. <br />
        Bitte formulieren Sie in ganzen Sätzen! </div>
    <div class="section">
        <!-- <label for="bericht">Bericht mit Anamnese / Verdachtsdiagnose / Vorschlägen zur weiteren Diagnostik und Therapievorschlägen</label> -->
        <textarea id="bericht" name="bericht" class="long-textarea"></textarea>
    </div>

    <button class="print-button" onclick="window.print()">Formular drucken</button>
    <button class="btn btn-primary me-2" id="saveBtn">Speichern</button>
    <input type="file" id="loadInput" accept="application/json" style="display:none">
    <button class="btn btn-secondary" id="loadBtn">Laden</button>
    <script>
    // Collect all form data into a JSON object
    function collectFormData() {
        return {
            patient: document.getElementById('patient').value,
            alter: document.getElementById('alter').value,
            groesse: document.getElementById('groesse').value,
            gewicht: document.getElementById('gewicht').value,
            datum: document.getElementById('datum').value,
            allergien: document.getElementsByName('allergien')[0].value,
            genussmittel: document.getElementsByName('genussmittel')[0].value,
            sozialanamnese: document.getElementsByName('sozialanamnese')[0].value,
            familienanamnese: document.getElementsByName('familienanamnese')[0].value,
            bericht: document.getElementById('bericht').value
        };
    }
    // Save responses as JSON file
    document.getElementById('saveBtn').onclick = function() {
        const data = collectFormData();
        // Format date as yyyyMMdd hh:mm
        const now = new Date();
        const pad = n => n.toString().padStart(2, '0');
        const yyyy = now.getFullYear();
        const MM = pad(now.getMonth() + 1);
        const dd = pad(now.getDate());
        const hh = pad(now.getHours());
        const mm = pad(now.getMinutes());
        const patient = (data.patient || '').replace(/[^a-zA-Z0-9_-]/g, '_').substring(0, 20);
        const defaultName = `${patient}-${yyyy}${MM}${dd} ${hh}_${mm}.json`;
        let fileName = prompt('Dateiname für die Speicherung:', defaultName);
        if (!fileName) return;
        if (!fileName.endsWith('.json')) fileName += '.json';
        const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    };
    // Load responses from JSON file
    document.getElementById('loadBtn').onclick = function() {
        document.getElementById('loadInput').click();
    };
    document.getElementById('loadInput').onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(evt) {
            try {
                const data = JSON.parse(evt.target.result);
                document.getElementById('patient').value = data.patient || '';
                document.getElementById('alter').value = data.alter || '';
                document.getElementById('groesse').value = data.groesse || '';
                document.getElementById('gewicht').value = data.gewicht || '';
                document.getElementById('datum').value = data.datum || '';
                document.getElementsByName('allergien')[0].value = data.allergien || '';
                document.getElementsByName('genussmittel')[0].value = data.genussmittel || '';
                document.getElementsByName('sozialanamnese')[0].value = data.sozialanamnese || '';
                document.getElementsByName('familienanamnese')[0].value = data.familienanamnese || '';
                document.getElementById('bericht').value = data.bericht || '';
            } catch (err) {
                alert('Ungültige JSON-Datei!');
            }
        };
        reader.readAsText(file);
    };
    </script>

</body>

</html>